<html>
  <head>
    <meta name="generator"
    content="HTML Tidy for HTML5 (experimental) for Windows https://github.com/w3c/tidy-html5/tree/c63cc39" />
    <title></title>
    <script type="text/javascript" src="node_modules/trkl/trkl-min.js"></script>
  </head>
  <body>
    <div id="app">
    </div>
  </body>
  
    <script>
    'use strict';
    var element = document.getElementById('app');
    
    let string = trkl('');
    let buttonFoo = trkl('<button onclick="stringAdd(\'foo\')">add foo</button>');
    let buttonBar = trkl('<button onclick="stringAdd(\'bar\')">add bar</button>');
    
    
    
    let models = trkl([
        { prop: trkl('John Doe')},
        { prop: trkl('Amy Doe')},
        { prop: trkl('3rd Doe')}        
    ]);
    
    let list = function () {
    
    return  '<button onclick="addToList()">add</button><ul>'+  
            models().map(
                function(obj, index){
                    return '<li>'+obj.prop()+'</li><button onclick="updateModel('+index+')">test</button>';
                }
            ).join(" ");
            +'</ul>';
    }
    
    
    let view = trkl.computed(()=> {
        return '<h1>'+string()+'</h1>'+buttonFoo()+buttonBar()+'<br/>'+list();
    });
    
    view.subscribe((newVal, oldVal) => {
        refresh();
    });      
       
    function stringAdd(text){
       string(string()+text); 
    }
    
    function updateModel(index){
        models()[index].prop('updaty Doe');
    }
    
    function addToList(){
        var arr = models();
        arr.push({prop: trkl('new doe')});
        models(
            arr
        );

    }
    
    function refresh(){
        console.time("view");
        element.innerHTML = view();
        console.timeEnd("view");
    }
    
    
    

    
    string('Hello World');
    
    
    </script>
    
</html>
